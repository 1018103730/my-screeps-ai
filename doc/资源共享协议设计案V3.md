# 资源共享协议设计案V3

-- **废弃：该设计案并未实装** --

## 新需求及老版本的不足

当前的资源共享协议只支持基础矿的共享，无法共享更细粒度的资源。

例如在 factory 合成中，需要在多房间中共享小批量、多种类的商品资源。当前的共享协议无法满足需求。

## 设计思路

全局维护的资源来源表改为请求池，有需求的房间会向请求池推送共享请求。而每个房间会定期运行共享任务收集模块，该模块会检查自己房间的 storage 和 terminal，并确定可以对外提供的资源表，然后根据该资源表去请求池中领取对应的资源共享请求。

## 当前问题

- 任务收集模块该怎么设计？如果即时遍历当前 storage 和 terminal 的资源的话，会不会因为种类太多造成 cpu 消耗过大？
- 针对上一个问题，房间的任务收集模块是否需要缓存对外提供的资源表？

## 持久化

全局的共享请求池:

```js
shareRequests: {
    // 资源类型, 其值为该资源的请求队列
    [RESOURCE_KEANIUM]: {
        // 发起请求的房间及其请求内容
        'W1N1': {
            // 请求的数量
            amount: 1000,
            // 是否有来源房间响应了该请求
            // 该值为 true 时搜索目标的来源房间将跳过该请求
            deal: true
        },
        // ...
    },
    // ...
}
```