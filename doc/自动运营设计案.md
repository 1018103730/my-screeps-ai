# 自动建设设计案（设计阶段）

## 整体框架

自动建设分为规划器和执行器两部分：

- 规划器：规划结果具有幂等性（只依赖于房间对象），负责根据房间地形规划建筑建造位置，包括以下几部分：
    - 基地中心位置规划：根据地形选择可以容纳下集中布局的中心点位
    - 集中布局规划：根据基地中心位置放置固定模板的建筑
    - 房间道路规划：规划从 source、controller、mineral 到集中布局入口的道路
    - 集中布局外规划：放置不在集中布局內部的建筑，如 sourceLink，或者 container 之类的。
    - 墙壁规划：渐进增强的 rampart 围墙包裹住集中布局。
- 执行器：负责将规划器产出的建筑位置放置为真实的建筑工地，需要完成以下功能：
    - 渐进放置：规划器会将 1-8 级所有的建筑都规划完成，执行器需要将其拆分成每一级可以放置的建筑。
    - 战后重建：快速发现被摧毁的建筑并进行补建。
    - 超限暂存：建筑工地最多放置 100 个，在超出上限时需要暂时存储没有放置的工地并稍后再试。

## 执行时机

规划器将在房间被占领后调用，会将产出的结果缓存至 global。执行器会去访问 global 中缓存的结果，没有发现缓存时也会调用规划器进行规划。

执行器会在房间升级、切出主动防御模式、日常工作发现某些建筑物找不到时由控制器调用。