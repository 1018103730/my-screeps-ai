# Lab 设计案（设计阶段）

# 目标

- 搭建完之后执行初始化命令就可以让 lab 集群自动工作。
- 工作目标是自动合成 G 矿、XLHO2、XKHO2、XGHO2、XZHO2 并存放至 terminal 中。

# 前提

lab 集群必须以固定格式搭建，并且初始化命令中传入的必须是指定位置的 lab。

# CLI 设计

初始化 lab 集群
```js
Room.linit('5d9bdd4b1acf0f000174aa4b') // 传入指定位置的 lab
```

# 原则

- lab 将作为一个整体运行，通过 `Room.linit` 可以指定一个 lab，而只有该 lab 会运行资源存取策划，其他的只是被动接收资源。

# 模块化

lab 集群的子模块包括：**长期目标**、**基本资源检查**、**任务规划器**、**当前任务** 和 **物流任务发布**。

**长期目标**

长期目标是指上文工作目标中的一个。lab 会在上一个长期目标完成之后开始进行新的长期目标挑选，当满足下面条件后将会将其确定为自己接下来要制作的目标：

- 该目标化合物在 terminal 中的储量不达标
- 该目标化合物所需要的基础原料都已经存在于 terminal 里（保证不会因原料不足而暂停合成，由基本资源检查模块负责）
- storage 中的能量大于 100k（暂定）

**基本资源检查**

该模块会接受其他模块传来的目标产物，然后查阅 terminal.store 中的底物是否足够，并返回可以合成的目标产物的数量（为 0 代表无法合成）

**任务规划器**

任务规划器是将长期目标细化成当前任务的桥梁，它会根据当前选定的长期目标，来检查 terminal 中的基础资源，从而确定当前需要进行什么化合物的合成（包括1/2/3级化合物），也就是当前任务的目标。于此同时，它还会根据基础资源的数量给出当前任务的目标产物数量。任务规划器会在长期目标确定后和当前任务完成后触发，并且在找到当前任务目标后会通知物流任务发布模块进行底物填充。

**当前任务**

当前任务是 lab 自动化合成的核心模块，它会接受任务规划器给出的当前任务目标、等待所需资源到位（由物流任务发布负责，transfer 角色填充），然后调用指定的 lab 建筑运行 `Lab.runReaction`，运行完成后检查产物数量是否足够。不足的话开始等待资源到位并循环进行合成，当产物数量足够时将会通知物流任务发布模块将生成好的产物移送至 terminal。

**物流任务发布**

该模块是 lab 集群和外部进行资源交换的纽带。任务规划器会通知该模块进行资源移入任务，而当前任务结束后会通知该模块进行产物资源移出。

# 流程

- 待补充