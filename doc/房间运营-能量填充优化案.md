# 能量填充优化案

由于给房间中的 spawn、extension、tower 填充能量是非常重要的业务，而 harvester 和 transfer 每 tick 都调用 `findClosestByRange` 搜索检查是一个不小的损耗，现通过优化方案如下：

# 操作拆分

取消 harvester、transfer 的主动搜索，转而交由建筑检查自己的能量是否填满，如果没填满就将自己的 id 填写到 `Room._needFillEnergyStructure` 属性中，(如果该属性存在则不再检查自己能量)

这样 harvester、transfer 的工作就简化成了监听 `Room._needFillEnergyStructure` 属性，只有当其出现时才会进行填充。

# 填满时的优化

由于建筑在 `Room._needFillEnergyStructure` 存在时才不会对自己的能量进行检查。如果所有建筑都填满了能量的话，则该字段就不会存在，也就是说所有的建筑都会对自己的能量进行检查。现决定通过如下方式优化掉这一部分能量检查：

# 能量锁

当 harvester、transfer 发现房间中不存在 `Room._needFillEnergyStructure` 字段时（说明房间里所有需要能量的建筑都被填满了），就将 `Room.memory.allStructureFillEnergy` 置为 true（上锁）。

当建筑发现 `Room.memory.allStructureFillEnergy` **存在**时就不再进行能量检查。

当 spawn 成功进行孵化时会删除 `Room.memory.allStructureFillEnergy` 字段（开锁）。